"use strict";(self.webpackChunkapi_dualdclic_fr=self.webpackChunkapi_dualdclic_fr||[]).push([[8056],{48601:(Oe,A,s)=>{s.r(A),s.d(A,{default:()=>De});var n=s(67294),o=s(68547),L=s(87751),T=s(97132),k=s(23724),w=s(49656),Z=s(36232),z=s.n(Z),O=s(78862),G=s(62031),Y=s(19408),J=s(80768),S=s.n(J),M=s(23998);const K=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"type",key:"type",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.type",defaultMessage:"Token type"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}}];var X=s(45697),c=s.n(X),h=s(49425),f=s(41798),q=s(67826),_=s(18568),ee=s.n(_),te=s(30741),ae=s(5493),ne=Object.defineProperty,I=Object.getOwnPropertySymbols,se=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,V=(a,e,t)=>e in a?ne(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,re=(a,e)=>{for(var t in e||(e={}))se.call(e,t)&&V(a,t,e[t]);if(I)for(var t of I(e))oe.call(e,t)&&V(a,t,e[t]);return a};const B=({tokenName:a,onClickDelete:e})=>{const{formatMessage:t}=(0,T.useIntl)(),{trackUsage:d}=(0,o.useTracking)();return n.createElement(ae.Box,re({paddingLeft:1},o.stopPropagation),n.createElement(te.IconButton,{onClick:()=>{d("willDeleteToken"),e()},label:t({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),noBorder:!0,icon:n.createElement(ee(),null)}))};B.propTypes={tokenName:c().string.isRequired,onClickDelete:c().func.isRequired};const le=B;var ie=s(19352),ce=s.n(ie),de=s(78384);const ue=(0,de.default)(o.Link)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,N=({tokenName:a,tokenId:e})=>{const{formatMessage:t}=(0,T.useIntl)(),{location:{pathname:d}}=(0,w.useHistory)();return n.createElement(ue,{to:`${d}/${e}`,title:t({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${a}`})},n.createElement(ce(),null))};N.propTypes={tokenName:c().string.isRequired,tokenId:c().oneOfType([c().string,c().number]).isRequired};const me=N;var pe=Object.defineProperty,R=Object.getOwnPropertySymbols,fe=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,j=(a,e,t)=>e in a?pe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,ge=(a,e)=>{for(var t in e||(e={}))fe.call(e,t)&&j(a,t,e[t]);if(R)for(var t of R(e))ye.call(e,t)&&j(a,t,e[t]);return a};const D=({canDelete:a,canUpdate:e,onClickDelete:t,withBulkActions:d,rows:m})=>{const{formatMessage:y}=(0,T.useIntl)(),[{query:u}]=(0,o.useQueryParams)(),[,p]=u.sort.split(":"),{push:l,location:{pathname:g}}=(0,w.useHistory)(),{trackUsage:E}=(0,o.useTracking)(),C=m.sort((r,v)=>{const P=r.name.localeCompare(v.name);return p==="DESC"?-P:P});return n.createElement(f.Tbody,null,C.map(r=>n.createElement(f.Tr,ge({key:r.id},(0,o.onRowClick)({fn(){E("willEditTokenFromList"),l(`${g}/${r.id}`)},condition:e})),n.createElement(f.Td,null,n.createElement(h.Typography,{textColor:"neutral800",fontWeight:"bold"},r.name)),n.createElement(f.Td,{maxWidth:(0,o.pxToRem)(250)},n.createElement(h.Typography,{textColor:"neutral800",ellipsis:!0},r.description)),n.createElement(f.Td,null,n.createElement(h.Typography,{textColor:"neutral800"},y({id:`Settings.apiTokens.types.${r.type}`,defaultMessage:"Type unknown"}))),n.createElement(f.Td,null,n.createElement(h.Typography,{textColor:"neutral800"},n.createElement(o.RelativeTime,{timestamp:new Date(r.createdAt)}))),d&&n.createElement(f.Td,null,n.createElement(q.Flex,{justifyContent:"end"},e&&n.createElement(me,{tokenName:r.name,tokenId:r.id}),a&&n.createElement(le,{tokenName:r.name,onClickDelete:()=>t(r.id)}))))))};D.defaultProps={canDelete:!1,canUpdate:!1,onClickDelete(){},rows:[],withBulkActions:!1},D.propTypes={canDelete:c().bool,canUpdate:c().bool,onClickDelete:c().func,rows:c().array,withBulkActions:c().bool};const ve=D;var Te=Object.defineProperty,he=Object.defineProperties,Ee=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertySymbols,Pe=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,x=(a,e,t)=>e in a?Te(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,U=(a,e)=>{for(var t in e||(e={}))Pe.call(e,t)&&x(a,t,e[t]);if($)for(var t of $(e))ke.call(e,t)&&x(a,t,e[t]);return a},F=(a,e)=>he(a,Ee(e)),b=(a,e,t)=>new Promise((d,m)=>{var y=l=>{try{p(t.next(l))}catch(g){m(g)}},u=l=>{try{p(t.throw(l))}catch(g){m(g)}},p=l=>l.done?d(l.value):Promise.resolve(l.value).then(y,u);p((t=t.apply(a,e)).next())});const we=()=>{(0,o.useFocusWhenNavigate)();const a=(0,k.useQueryClient)(),{formatMessage:e}=(0,T.useIntl)(),t=(0,o.useNotification)(),{allowedActions:{canCreate:d,canDelete:m,canUpdate:y,canRead:u}}=(0,o.useRBAC)(L.Z.settings["api-tokens"]),{push:p}=(0,w.useHistory)(),{trackUsage:l}=(0,o.useTracking)(),{startSection:g}=(0,o.useGuidedTour)(),E=(0,n.useRef)(g);(0,n.useEffect)(()=>{E.current&&E.current("apiTokens")},[]),(0,n.useEffect)(()=>{p({search:z().stringify({sort:"name:ASC"},{encode:!1})})},[p]);const C=K.map(i=>F(U({},i),{metadatas:F(U({},i.metadatas),{label:e(i.metadatas.label)})})),{data:r,status:v,isFetching:P}=(0,k.useQuery)(["api-tokens"],()=>b(void 0,null,function*(){l("willAccessTokenList");const{data:{data:i}}=yield M.be.get("/admin/api-tokens");return l("didAccessTokenList",{number:i.length}),i}),{enabled:u,onError(){t({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),H=u&&(v!=="success"&&v!=="error"||v==="success"&&P),be=(0,k.useMutation)(i=>b(void 0,null,function*(){yield M.be.delete(`/admin/api-tokens/${i}`)}),{onSuccess(){return b(this,null,function*(){yield a.invalidateQueries(["api-tokens"]),l("didDeleteToken")})},onError(i){var Q,W;(W=(Q=i==null?void 0:i.response)==null?void 0:Q.data)!=null&&W.data?t({type:"warning",message:i.response.data.data}):t({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ce=u&&r,Ae=u&&!r&&!d,Le=u&&!r&&d;return n.createElement(G.Main,{"aria-busy":H},n.createElement(o.SettingsPageTitle,{name:"API Tokens"}),n.createElement(O.HeaderLayout,{title:e({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:e({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:d?n.createElement(o.LinkButton,{"data-testid":"create-api-token-button",startIcon:n.createElement(S(),null),size:"S",onClick:()=>l("willAddTokenFromList"),to:"/settings/api-tokens/create"},e({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})):void 0}),n.createElement(O.ContentLayout,null,!u&&n.createElement(o.NoPermissions,null),Ce&&n.createElement(o.DynamicTable,{headers:C,contentType:"api-tokens",rows:r,withBulkActions:m||y,isLoading:H,onConfirmDelete:i=>be.mutateAsync(i)},n.createElement(ve,{canDelete:m,canUpdate:y,rows:r,withBulkActions:m||y})),Le&&n.createElement(o.NoContent,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:n.createElement(Y.Button,{variant:"secondary",startIcon:n.createElement(S(),null)},e({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"}))}),Ae&&n.createElement(o.NoContent,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})))},De=()=>n.createElement(o.CheckPagePermissions,{permissions:L.Z.settings["api-tokens"].main},n.createElement(we,null))}}]);
